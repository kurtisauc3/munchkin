{"version":3,"sources":["scenes/main-scene.ts","plugins/electron.ts","plugins/server.ts","plugins/index.ts","config.ts","game.ts","../node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,kBAAgB;AAIhB,MAAM,SAAU,SAAQ,MAAM,CAAC,KAAK;IAElC;QACE,KAAK,CAAC,EAAE,GAAG,EAAE,WAAW,EAAE,CAAC,CAAC;IAC9B,CAAC;IAED,IAAI;QACF,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,CAAiB,CAAC;IACxE,CAAC;IAED,OAAO,KAAI,CAAC;IAEN,MAAM;;YACV,MAAM,sBAAsB,GAAG,CAAO,UAAkD,EAAE,EAAE,EAAE;gBAC5F,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,IAAI,CAC/C,mCAAmC,EACnC,OAAO,CACR,CAAC;gBACF,OAAO,QAAQ,CAAC,MAAM,KAAK,KAAK,CAAC;YACnC,CAAC,CAAA,CAAC;YACF,sBAAsB,EAAE,CAAC;QAC3B,CAAC;KAAA;IAED,MAAM,KAAU,CAAC;CAClB;AAEQ,8BAAS;;;;;;ACgBlB,MAAM,QAAQ,GAAG,MAAM,CAAC,OAAO,CAAC,UAAU,CAAmB,CAAC;AAGrD,4BAAQ;AAFjB,MAAM,QAAQ,GAAG,QAAQ,CAAC,WAAW,CAAC,QAAQ,CAAC,UAAU,CAAa,CAAC;AAEpD,4BAAQ;;;;;;;;;ACjD3B,kDAA2F;AAC3F,yCAAgD;AAChD,uDAAsC;AActC,MAAM,YAAa,SAAQ,MAAM,CAAC,OAAO,CAAC,UAAU;IAIlD,YAAY,aAA2C;QACrD,KAAK,CAAC,aAAa,CAAC,CAAC;QACrB,MAAM,QAAQ,GAAG,eAAK,CAAC,MAAM,EAAE,CAAC;QAChC,MAAM,SAAS,GAAG,mBAAQ,CAAC,WAAW,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;QAC7D,MAAM,OAAO,GAAG,GAAG,SAAS,MAAM,CAAC;QACnC,QAAQ,CAAC,QAAQ,CAAC,OAAO,GAAG,OAAO,CAAC;QACpC,QAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,eAAe,CAAC,GAAG,UAAU,mBAAQ,CAAC,WAAW,EAAE,CAAC;QACrF,QAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,cAAc,CAAC,GAAG,kBAAkB,CAAC;QACtE,QAAQ,CAAC,YAAY,CAAC,QAAQ,CAAC,GAAG,CAChC,CAAC,QAAuB,EAAE,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,EAC3D,CAAC,KAAiB,EAAE,EAAE;YACpB,IAAI,KAAK,CAAC,QAAQ,EAAE;gBAClB,MAAM,EAAE,MAAM,EAAE,UAAU,EAAE,GAAG,KAAK,CAAC,QAAQ,CAAC;gBAC9C,OAAO,OAAO,CAAC,MAAM,CAAC,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC,CAAC;aAC/C;YACD,OAAO,OAAO,CAAC,MAAM,CAAC;gBACpB,MAAM,EAAE,GAAG;gBACX,UAAU,EAAE,qBAAqB;aAClC,CAAC,CAAC;QACL,CAAC,CACF,CAAC;QACF,IAAI,CAAC,GAAG,GAAG,QAAQ,CAAC;QACpB,IAAI,CAAC,MAAM,GAAG,IAAA,qBAAE,EAAC,SAAS,EAAE;YAC1B,WAAW,EAAE,IAAI;YACjB,IAAI,EAAE;gBACJ,KAAK,EAAE,UAAU,mBAAQ,CAAC,WAAW,EAAE;aACxC;YACD,UAAU,EAAE,CAAC,WAAW,CAAC;SAC1B,CAAC,CAAC;QACH,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,SAAS,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,qCAAqC,CAAC,CAAC,CAAC;QACpF,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,eAAe,EAAE,CAAC,KAAK,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,iCAAiC,EAAE,KAAK,CAAC,CAAC,CAAC;IACpG,CAAC;CACF;AAEQ,oCAAY;;;;;;;;;;;;;;;;;;;ACtDrB,2CAAyB;AACzB,6CAA2B;;;;;;ACD3B,oDAAgD;AAChD,uCAAyC;AAEzC,MAAM,EAAE,UAAU,EAAE,WAAW,EAAE,GAAG,OAAO,CAAC,GAAG,CAAC;AAEnC,QAAA,UAAU,GAAiC;IACtD,KAAK,EAAE,UAAU;IACjB,KAAK,EAAE,QAAQ,CAAC,UAAU,CAAC;IAC3B,MAAM,EAAE,QAAQ,CAAC,WAAW,CAAC;IAC7B,IAAI,EAAE,MAAM,CAAC,IAAI;IACjB,MAAM,EAAE,MAAM;IACd,KAAK,EAAE,CAAC,sBAAS,CAAC;IAClB,OAAO,EAAE;QACP,MAAM,EAAE;YACN;gBACE,MAAM,EAAE,sBAAY;gBACpB,GAAG,EAAE,eAAe;gBACpB,KAAK,EAAE,IAAI;aACZ;SACF;KACF;CACF,CAAC;;;;;;ACrBF,kBAAgB;AAChB,qCAAsC;AAEtC,MAAa,IAAK,SAAQ,MAAM,CAAC,IAAI;IACnC,YAAY,MAAoC;QAC9C,KAAK,CAAC,MAAM,CAAC,CAAC;IAChB,CAAC;CACF;AAJD,oBAIC;AAED,MAAM,CAAC,gBAAgB,CAAC,MAAM,EAAE,GAAG,EAAE;IACnC,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC,mBAAU,CAAC,CAAC;AACpC,CAAC,CAAC,CAAC;;;ACXH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"game.4fb5d41c.js","sourceRoot":"../src","sourcesContent":["import 'Phaser';\nimport { ApiV1UserIsMyUsernameRegisteredRequest, ApiV1UserIsMyUsernameRegisteredResponse } from '@shared';\nimport { ServerPlugin } from 'src/plugins';\n\nclass MainScene extends Phaser.Scene {\n  serverPlugin: ServerPlugin;\n  constructor() {\n    super({ key: 'MainScene' });\n  }\n\n  init() {\n    this.serverPlugin = this.plugins.get('server-plugin') as ServerPlugin;\n  }\n\n  preload() {}\n\n  async create() {\n    const isMyUsernameRegistered = async (request: ApiV1UserIsMyUsernameRegisteredRequest = {}) => {\n      const response = await this.serverPlugin.api.post<ApiV1UserIsMyUsernameRegisteredResponse>(\n        'v1/user/is-my-username-registered',\n        request\n      );\n      return response.answer === 'yes';\n    };\n    isMyUsernameRegistered();\n  }\n\n  update(): void {}\n}\n\nexport { MainScene };\n","import * as Electron from 'electron';\ninterface GoogleProfile {\n  aud: string;\n  email: string;\n  email_verified: boolean;\n  exp: number;\n  family_name: string;\n  given_name: string;\n  iat: number;\n  iss: string;\n  locale: string;\n  name: string;\n  nickname: string;\n  picture: string;\n  sub: string;\n  updated_at: string;\n}\ninterface EmailProfile {\n  aud: string;\n  email: string;\n  email_verified: boolean;\n  exp: number;\n  iat: number;\n  iss: string;\n  name: string;\n  nickname: string;\n  picture: string;\n  sub: string;\n  updated_at: string;\n}\ninterface UserData {\n  accessToken: string;\n  profile: GoogleProfile | EmailProfile;\n}\ntype ClientElectron = Pick<\n  typeof Electron,\n  | 'clipboard'\n  | 'contextBridge'\n  | 'crashReporter'\n  | 'desktopCapturer'\n  | 'ipcRenderer'\n  | 'nativeImage'\n  | 'shell'\n  | 'webFrame'\n>;\n\nconst electron = window.require('electron') as ClientElectron;\nconst userData = electron.ipcRenderer.sendSync('userData') as UserData;\n\nexport { electron, userData };\n","import axios, { AxiosError, AxiosRequestConfig, AxiosResponse, AxiosAdapter } from 'axios';\nimport { electron, userData } from './electron';\nimport { io } from 'socket.io-client';\n\ntype SocketInstance = ReturnType<typeof io>;\n\ninterface ApiInstance {\n  request<T = any>(config: AxiosRequestConfig): Promise<T>;\n  get<T = any>(url: string, config?: AxiosRequestConfig): Promise<T>;\n  delete<T = any>(url: string, config?: AxiosRequestConfig): Promise<T>;\n  head<T = any>(url: string, config?: AxiosRequestConfig): Promise<T>;\n  post<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T>;\n  put<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T>;\n  patch<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T>;\n}\n\nclass ServerPlugin extends Phaser.Plugins.BasePlugin {\n  socket: SocketInstance;\n  api: ApiInstance;\n\n  constructor(pluginManager: Phaser.Plugins.PluginManager) {\n    super(pluginManager);\n    const instance = axios.create();\n    const serverURL = electron.ipcRenderer.sendSync('serverURL');\n    const baseUrl = `${serverURL}api/`;\n    instance.defaults.baseURL = baseUrl;\n    instance.defaults.headers.common['Authorization'] = `Bearer ${userData.accessToken}`;\n    instance.defaults.headers.common['Content-Type'] = 'application/json';\n    instance.interceptors.response.use(\n      (response: AxiosResponse) => Promise.resolve(response.data),\n      (error: AxiosError) => {\n        if (error.response) {\n          const { status, statusText } = error.response;\n          return Promise.reject({ status, statusText });\n        }\n        return Promise.reject({\n          status: 503,\n          statusText: 'Service unavailable'\n        });\n      }\n    );\n    this.api = instance;\n    this.socket = io(serverURL, {\n      autoConnect: true,\n      auth: {\n        token: `Bearer ${userData.accessToken}`\n      },\n      transports: ['websocket']\n    });\n    this.socket.on('connect', () => console.log('[socket.io-client] Client connected'));\n    this.socket.on('connect_error', (error) => console.log('[socket.io-client] Client error', error));\n  }\n}\n\nexport { ServerPlugin };\n","export * from './server';\nexport * from './electron';\n","import { MainScene } from './scenes/main-scene';\nimport { ServerPlugin } from './plugins';\n\nconst { GAME_WIDTH, GAME_HEIGHT } = process.env;\n\nexport const GameConfig: Phaser.Types.Core.GameConfig = {\n  title: 'Munchkin',\n  width: parseInt(GAME_WIDTH),\n  height: parseInt(GAME_HEIGHT),\n  type: Phaser.AUTO,\n  parent: 'game',\n  scene: [MainScene],\n  plugins: {\n    global: [\n      {\n        plugin: ServerPlugin,\n        key: 'server-plugin',\n        start: true\n      }\n    ]\n  }\n};\n","import 'Phaser';\nimport { GameConfig } from './config';\n\nexport class Game extends Phaser.Game {\n  constructor(config: Phaser.Types.Core.GameConfig) {\n    super(config);\n  }\n}\n\nwindow.addEventListener('load', () => {\n  const game = new Game(GameConfig);\n});\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel] ✨ Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel] 🚨  ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\">🚨</span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}